"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6326],{6326:(Z,p,r)=>{r.r(p),r.d(p,{DashboardPageModule:()=>y});var u=r(6895),g=r(4719),l=r(191),h=r(5181),m=r(5861),e=r(4650),b=r(2796),A=r(1056);function _(s,c){if(1&s){const a=e.EpF();e.TgZ(0,"ion-item")(1,"ion-searchbar",9),e.NdJ("ngModelChange",function(d){e.CHM(a);const o=e.oxw();return e.KtG(o.searchInput=d)})("keyup",function(d){e.CHM(a);const o=e.oxw();return e.KtG(o.searchBusiness(d))}),e.qZA()()}if(2&s){const a=e.oxw();e.xp6(1),e.Q6J("ngModel",a.searchInput)}}function P(s,c){if(1&s&&(e.TgZ(0,"ion-card")(1,"ion-row")(2,"ion-col",11),e._uU(3),e.qZA(),e.TgZ(4,"ion-col",12),e._uU(5),e.qZA()(),e.TgZ(6,"ion-row")(7,"ion-col"),e._uU(8,"Issued Date"),e.qZA(),e.TgZ(9,"ion-col"),e._uU(10),e.qZA()(),e.TgZ(11,"ion-row")(12,"ion-col"),e._uU(13,"LAN No"),e.qZA(),e.TgZ(14,"ion-col"),e._uU(15),e.qZA()(),e.TgZ(16,"ion-row")(17,"ion-col"),e._uU(18,"Bank Name"),e.qZA(),e.TgZ(19,"ion-col"),e._uU(20),e.qZA()(),e.TgZ(21,"ion-row")(22,"ion-col"),e._uU(23,"Agent Pay"),e.qZA(),e.TgZ(24,"ion-col"),e._uU(25),e.qZA()(),e.TgZ(26,"ion-row")(27,"ion-col"),e._uU(28,"Sub Agent Pay"),e.qZA(),e.TgZ(29,"ion-col"),e._uU(30),e.qZA()(),e.TgZ(31,"ion-row")(32,"ion-col"),e._uU(33,"Qc Status"),e.qZA(),e.TgZ(34,"ion-col"),e._uU(35),e.qZA()()()),2&s){const a=c.$implicit;e.xp6(3),e.Oqu(a.name),e.xp6(2),e.hij("\u20b9 ",a.disbursedAmount,""),e.xp6(5),e.Oqu(a.disburseDate),e.xp6(5),e.Oqu(a.lanNo),e.xp6(5),e.Oqu(a.bankName),e.xp6(5),e.Oqu(a.amountToPayAgent),e.xp6(5),e.Oqu(a.amountToPaySubAgent),e.xp6(5),e.Oqu("A"==a.approvedbyadmin?"Approved":"R"==a.approvedbyadmin?"Rejected":"H"==a.approvedbyadmin?"Hold":"P"==a.approvedbyadmin?"Pending":"Paid"==a.approvedbyadmin?"Paid":"NA")}}function v(s,c){if(1&s&&(e.TgZ(0,"div"),e.YNc(1,P,36,8,"ion-card",10),e.qZA()),2&s){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.top5Records)}}const f=[{path:"",component:(()=>{class s{constructor(a,t,d){this.router=a,this.firestore=t,this.commondataService=d,this.yearValues=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],this.dashboard={},this.top5Records=[],this.top5=!0,this.downloaddata=[],this.top5RecordsSaved=[],this.dashboard.totalredeem="0",this.dashboard.invalidcases="0",this.dashboard.totalcases="0",this.dashboard.totalpaid="0",this.dashboard.totalpending="0",this.userRole=JSON.parse(localStorage.userData).role,"agent"==this.userRole?(this.top5=!0,this.firestore.collection("business",o=>o.where("agent","==",JSON.parse(localStorage.userData).email).limit(5)).get().subscribe(o=>{console.log("Top 5 docs here"),console.log(o),o.docs.forEach(i=>{console.log(i.data());var n=i.data();console.log(n),n.id=i.id,this.top5Records.push(n),this.top5RecordsSaved.push(n)})}),console.log(this.commondataService.allPendingBusiness),this.firestore.collection("business",o=>o.where("agent","==",JSON.parse(localStorage.userData).email)).get().subscribe(o=>{console.log("all docs here"),console.log(o),this.paidAmount=0,this.pendingAmount=0,this.dashboard.totalcases=o.docs.length,o.docs.forEach(i=>{console.log(i.data());var n=i.data();console.log(n),n.id=i.id,"true"==n.agentPaid?this.paidAmount=this.paidAmount+n.amountToPayAgent?n.amountToPayAgent:0:"false"==n.agentPaid&&(this.pendingAmount=this.pendingAmount+n.amountToPayAgent?n.amountToPayAgent:0),this.commondataService.allPendingBusiness.push(n)}),this.dashboard.totalpaid=this.paidAmount,this.dashboard.totalpending=this.pendingAmount}),console.log(this.commondataService.allPendingBusiness),this.firestore.collection("business",o=>o.where("agent","==",JSON.parse(localStorage.userData).email).where("approvedbyadmin","==","R")).get().subscribe(o=>{console.log("all docs here"),console.log(o),this.dashboard.invalidcases=o.docs.length,o.docs.forEach(i=>{console.log(i.data());var n=i.data();console.log(n),n.id=i.id,this.commondataService.allInvalidBusiness.push(n)})}),console.log(this.commondataService.allInvalidBusiness)):(this.top5=!1,this.firestore.collection("business",o=>o.where("createdBy","==",JSON.parse(localStorage.userData).email)).get().subscribe(o=>{console.log("all docs here"),console.log(o),this.paidAmount=0,this.pendingAmount=0,this.dashboard.totalcases=o.docs.length,o.docs.forEach(i=>{console.log(i.data());var n=i.data();console.log(n),n.id=i.id,"true"==n.amountToPaySubAgent?this.paidAmount=this.paidAmount+n.amountToPaySubAgent?n.amountToPaySubAgent:0:"false"==n.amountToPaySubAgent&&(this.pendingAmount=this.pendingAmount+n.amountToPaySubAgent?n.amountToPaySubAgent:0),this.commondataService.allPendingBusiness.push(n)}),this.dashboard.totalpaid=this.paidAmount,this.dashboard.totalpending=this.pendingAmount}),console.log(this.commondataService.allPendingBusiness),this.firestore.collection("business",o=>o.where("createdBy","==",JSON.parse(localStorage.userData).email).where("approvedbyadmin","==","R")).get().subscribe(o=>{console.log("all docs here"),console.log(o),this.dashboard.invalidcases=o.docs.length,o.docs.forEach(i=>{console.log(i.data());var n=i.data();console.log(n),n.id=i.id,this.commondataService.allInvalidBusiness.push(n)})}),console.log(this.commondataService.allInvalidBusiness))}goto(a){this.router.navigate([a])}searchBusiness(a){console.log(a),this.top5Records=this.top5RecordsSaved.filter(t=>t.name.toString().includes(a.target.value)||t.lanNo.toString().includes(a.target.value.toString())?t:void 0)}ngOnInit(){}exportReport(){var a=this;return(0,m.Z)(function*(){yield a.firestore.collection("business",t=>t.where("createdBy","==",JSON.parse(localStorage.userData).email)).get().subscribe(t=>{a.reportData=t.docs,t.docs.forEach(o=>{console.log(o.data()),a.downloaddata.push({"Business Name":o.data().name?o.data().name:"","Lan Number":o.data().lanNo?o.data().lanNo:"","Created By Email":o.data().createdBy?o.data().createdBy:"","Created By Name":o.data().createdByName?o.data().createdByName:"","Disbused Amount":o.data().disbursedAmount?o.data().disbursedAmount:"","Disbused Date":o.data().disburseDate?o.data().disburseDate:"","QC Status":"R"==o.data().approvedbyadmin?"Reject":"P"==o.data().approvedbyadmin?"Pending":"H"==o.data().approvedbyadmin?"Hold":"Paid"==o.data().approvedbyadmin?"Paid":"NA","Agent Paymet":o.data().amountToPayAgent?o.data().amountToPayAgent:"","Sub Agent Payment":o.data().amountToPaySubAgent?o.data().amountToPaySubAgent:""})});const d=a.objectToCsv(a.downloaddata);console.log(d),a.download(d)})})()}objectToCsv(a){if(0!=a.length){const t=[],d=Object.keys(a[0]);t.push(d.join(","));for(const o of a){const i=d.map(n=>`"${(""+o[n]).replace(/"/g,'\\"')}"`);t.push(i.join(","))}return t.join("\n")}alert("No Data Found")}download(a){console.log(a);const t=new Blob([a],{type:"text/csv"}),d=window.URL.createObjectURL(t),o=document.createElement("a");o.setAttribute("hidden",""),o.setAttribute("href",d),o.setAttribute("download","download.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}return s.\u0275fac=function(a){return new(a||s)(e.Y36(h.F0),e.Y36(b.ST),e.Y36(A.Y))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-dashboard"]],decls:32,vars:6,consts:[[1,"header-color"],["slot","start"],[2,"margin","15%"],[2,"text-align","center"],["readonly","",3,"ngModel","ngModelChange"],["readonly","",3,"ngModel","click","ngModelChange"],[4,"ngIf"],[1,"btnStyle"],["shape","round",3,"click"],["placeholder","Enter LAN Number",3,"ngModel","ngModelChange","keyup"],[4,"ngFor","ngForOf"],["size","8"],["size","4"]],template:function(a,t){1&a&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Dashboard"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-grid",2)(8,"ion-row",3)(9,"ion-col")(10,"ion-label"),e._uU(11,"Total Paid Amount (in \u20b9)"),e.qZA(),e.TgZ(12,"ion-input",4),e.NdJ("ngModelChange",function(o){return t.dashboard.totalpaid=o}),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label"),e._uU(15,"Total Pending Amount (in \u20b9)"),e.qZA(),e.TgZ(16,"ion-input",4),e.NdJ("ngModelChange",function(o){return t.dashboard.totalpending=o}),e.qZA()()(),e.TgZ(17,"ion-row",3)(18,"ion-col")(19,"ion-label"),e._uU(20,"Total Number of Cases"),e.qZA(),e.TgZ(21,"ion-input",5),e.NdJ("click",function(){return t.goto("totalcases")})("ngModelChange",function(o){return t.dashboard.totalcases=o}),e.qZA()(),e.TgZ(22,"ion-col")(23,"ion-label"),e._uU(24,"Total Invalid Cases"),e.qZA(),e.TgZ(25,"ion-input",5),e.NdJ("click",function(){return t.goto("invalidcases")})("ngModelChange",function(o){return t.dashboard.invalidcases=o}),e.qZA()()()(),e.YNc(26,_,2,1,"ion-item",6),e._UZ(27,"div"),e.YNc(28,v,2,1,"div",6),e.TgZ(29,"div",7)(30,"ion-button",8),e.NdJ("click",function(){return t.exportReport()}),e._uU(31,"Export to Exel"),e.qZA()()()),2&a&&(e.xp6(12),e.Q6J("ngModel",t.dashboard.totalpaid),e.xp6(4),e.Q6J("ngModel",t.dashboard.totalpending),e.xp6(5),e.Q6J("ngModel",t.dashboard.totalcases),e.xp6(4),e.Q6J("ngModel",t.dashboard.invalidcases),e.xp6(1),e.Q6J("ngIf","agent"==t.userRole&&1==t.top5),e.xp6(2),e.Q6J("ngIf","agent"==t.userRole&&1==t.top5))},dependencies:[u.sg,u.O5,g.JJ,g.On,l.oU,l.YG,l.Sm,l.PM,l.wI,l.W2,l.jY,l.Gu,l.pK,l.Ie,l.Q$,l.Nd,l.VI,l.wd,l.sr,l.j9,l.cs],styles:[".ion-margin[_ngcontent-%COMP%]{--ion-grid-column-padding: 10px;border-collapse:collapse;border-style:hidden}.ion-margin[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:first-child{font-weight:700}.ion-margin[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border:1px solid black;border-bottom:0;border-right:0}.ion-margin[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:last-child{border-right:1px solid black}.ion-margin[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:last-child{border-bottom:1px solid black}.btnStyle[_ngcontent-%COMP%]{text-align:center}.btnStyleIn[_ngcontent-%COMP%]{--border-radius: 50%}"]}),s})()}];let T=(()=>{class s{}return s.\u0275fac=function(a){return new(a||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[h.Bz.forChild(f),h.Bz]}),s})(),y=(()=>{class s{}return s.\u0275fac=function(a){return new(a||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[u.ez,g.u5,l.Pc,T]}),s})()}}]);